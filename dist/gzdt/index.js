"use strict";(()=>{var c=(e,t=!0)=>e.cloneNode(t);async function u(e){try{let t=await fetch(e);return t.ok?await t.json():[]}catch{return[]}}function d(){window.scrollTo({top:0,behavior:"smooth"})}var m=1,b=1,T=30,x=[],r=1,S=0,p=10,s=Math.floor(p/2),w=null,E="gzdt";window.Webflow||(window.Webflow=[]);window.Webflow.push(async()=>{let e=await u(`http://metro-info.edwardxwliu.cn:5000/stat?key=${E}&per_page=${T}`);r=e[0].tot_pages,S=e[0].tot_items,l(m),L(),setInterval(h,5e3)});async function h(){if(b===1){let e=await u(`http://metro-info.edwardxwliu.cn:5000/stat?key=${E}&per_page=${T}`),t=e[0].tot_items;t!==S&&(S=t,r=e[0].tot_pages,l(b))}}function L(){let e=document.querySelector('[data-element="next-page"]'),t=document.querySelector('[data-element="previous-page"]');e&&e.addEventListener("click",()=>{l(m+1),d()}),t&&t.addEventListener("click",()=>{l(m-1),d()})}var D=(e,t)=>{let o=c(t);return o&&(o.textContent=e.toString(),o.setAttribute("page-nav-index",e.toString())),o.addEventListener("click",()=>{w||(w=window.setTimeout(()=>{w=null,o.disabled||(l(e),d())},500))}),o},f=async(e,t)=>{let o=document.querySelector('[data-element="page-index"]');if(!o)return;let a=o.parentElement;o.remove(),o.classList.remove("page-index_active");for(let n=e;n<=t;n++)a.append(D(n,o))},N=({title:e,url:t,p_date:o},a)=>{let n=c(a),i=n.querySelector('[data-element="news-title"]'),y=n.querySelector('[data-element="news-date"]');return i&&(i.textContent=e,i.href=t),y&&(y.textContent=o),n.removeAttribute("data-cloak"),n},l=async e=>{if(b=e,e<1||e>r)return;let t=await u(`http://metro-info.edwardxwliu.cn:5000/search?key=${E}&page=${e}&per_page=${T}`);if(!t){window.location.replace("/");return}let o=document.querySelector('[data-element="news-item"]');if(!o)return;let a=o.parentElement,n=t.map(i=>N(i,o));x&&x.map(i=>a.removeChild(i)),o.remove(),a.append(...n),x=n,I(e),m=e};function I(e){r>1&&(k(e),r<=p?f(1,r):e+s>r?f(r-p+1,r):e<=s?f(1,p):e>s&&f(e-s,e+s)),v(e),e!==m&&g(m),e===1?v(0):g(0),e===r?v(-1):g(-1)}var v=e=>{let t=document.querySelector(`[page-nav-index="${e}"]`);t?.classList.add("page-index_active"),t&&(t.disabled=!0)},g=e=>{let t=document.querySelector(`[page-nav-index="${e}"]`);t?.classList.remove("page-index_active"),t&&(t.disabled=!1)},_=e=>{document.querySelector(`[page-nav-index="${e}"]`)?.remove()},k=e=>{let t=document.querySelector('[data-element="page-index-wrap"]');if(!t)return;let o=t.firstElementChild?.getAttribute("page-nav-index"),a=t.lastElementChild?.getAttribute("page-nav-index");if(o&&a)for(let n=+o;n<=+a;n++)n!==e&&_(n)};})();
