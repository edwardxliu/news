"use strict";(()=>{var c=(e,t=!0)=>e.cloneNode(t);async function u(e){try{let t=await fetch(e);return t.ok?await t.json():[]}catch{return[]}}var m=1,v=1,S=30,p=[],r=1,b=0,f=10,s=Math.floor(f/2),x=null,E="gzdt";window.Webflow||(window.Webflow=[]);window.Webflow.push(async()=>{let e=await u(`http://metro-info.edwardxwliu.cn:5000/stat?key=${E}&per_page=${S}`);r=e[0].tot_pages,b=e[0].tot_items,l(m),L(),setInterval(T,5e3)});async function T(){if(v===1){let e=await u(`http://metro-info.edwardxwliu.cn:5000/stat?key=${E}&per_page=${S}`),t=e[0].tot_items;t!==b&&(b=t,r=e[0].tot_pages,l(v))}}function L(){let e=document.querySelector('[data-element="next-page"]'),t=document.querySelector('[data-element="previous-page"]');e&&e.addEventListener("click",()=>{l(m+1)}),t&&t.addEventListener("click",()=>{l(m-1)})}var h=(e,t)=>{let n=c(t);return n&&(n.textContent=e.toString(),n.setAttribute("page-nav-index",e.toString())),n.addEventListener("click",()=>{x||(x=window.setTimeout(()=>{x=null,n.disabled||l(e)},500))}),n},d=async(e,t)=>{let n=document.querySelector('[data-element="page-index"]');if(!n)return;let a=n.parentElement;n.remove(),n.classList.remove("page-index_active");for(let o=e;o<=t;o++)a.append(h(o,n))},D=({title:e,url:t,p_date:n},a)=>{let o=c(a),i=o.querySelector('[data-element="news-title"]'),y=o.querySelector('[data-element="news-date"]');return i&&(i.textContent=e,i.href=t),y&&(y.textContent=n),o.removeAttribute("data-cloak"),o},l=async e=>{if(v=e,e<1||e>r)return;let t=await u(`http://metro-info.edwardxwliu.cn:5000/search?key=${E}&page=${e}&per_page=${S}`);if(!t){window.location.replace("/");return}let n=document.querySelector('[data-element="news-item"]');if(!n)return;let a=n.parentElement,o=t.map(i=>D(i,n));p&&p.map(i=>a.removeChild(i)),n.remove(),a.append(...o),p=o,N(e),m=e};function N(e){r>1&&(_(e),r<=f?d(1,r):e+s>r?d(r-f+1,r):e<=s?d(1,f):e>s&&d(e-s,e+s)),w(e),e!==m&&g(m),e===1?w(0):g(0),e===r?w(-1):g(-1)}var w=e=>{let t=document.querySelector(`[page-nav-index="${e}"]`);t?.classList.add("page-index_active"),t&&(t.disabled=!0)},g=e=>{let t=document.querySelector(`[page-nav-index="${e}"]`);t?.classList.remove("page-index_active"),t&&(t.disabled=!1)},I=e=>{document.querySelector(`[page-nav-index="${e}"]`)?.remove()},_=e=>{let t=document.querySelector('[data-element="page-index-wrap"]');if(!t)return;let n=t.firstElementChild?.getAttribute("page-nav-index"),a=t.lastElementChild?.getAttribute("page-nav-index");if(n&&a)for(let o=+n;o<=+a;o++)o!==e&&I(o)};})();
