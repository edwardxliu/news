{
  "version": 3,
  "sources": ["../../bin/live-reload.js", "../../node_modules/.pnpm/@finsweet+ts-utils@0.40.0/node_modules/@finsweet/ts-utils/dist/helpers/cloneNode.js", "../../src/utils/api.ts", "../../src/search/index.ts"],
  "sourcesContent": ["new EventSource(`${SERVE_ORIGIN}/esbuild`).addEventListener('change', () => location.reload());\r\n", "/**\n * Clone a node that has the same type as the original one\n * @param node\n */\nexport const cloneNode = (node, deep = true) => node.cloneNode(deep);\n", "// import type { NewsData } from './types';\r\n\r\n/**\r\n * \u4ECE\u540E\u7AEF\u83B7\u53D6\u6570\u636E\r\n * @param url \u540E\u7AEF\u8BF7\u6C42\u5730\u5740\r\n * @returns json\u6570\u7EC4, \u6CA1\u627E\u5230\u8FD4\u56DE\u7A7A\u6570\u7EC4[]\r\n */\r\n// export const fetchNewsDatabase = async (url: string): Promise<NewsData[]> => {\r\nexport async function fetchData<T>(url: string): Promise<T[]> {\r\n  try {\r\n    const response = await fetch(url);\r\n    if (!response.ok) {\r\n      return [];\r\n    }\r\n\r\n    // const data: NewsData[] = await response.json();\r\n    const data = await response.json();\r\n    return data as T[];\r\n  } catch (err) {\r\n    return [];\r\n  }\r\n}\r\n\r\n/**\r\n * \u4EE5\u56FA\u5B9A\u683C\u5F0F\u8FD4\u56DE\u5F53\u524D\u65E5\u671F\r\n * @returns yyyy-mm-dd\r\n */\r\nexport function getCurrentDate(): string {\r\n  const now = Date.now();\r\n  const date = new Date(now);\r\n  const mth = String(date.getMonth() + 1).padStart(2, '0');\r\n  const day = String(date.getDate()).padStart(2, '0');\r\n\r\n  return `${date.getFullYear()}-${mth}-${day}`;\r\n}\r\n\r\n// export const fetchNewsStatDatabase = async (url: string) => {\r\n//   try {\r\n//     const response = await fetch(url);\r\n//     if (!response.ok) {\r\n//       return [];\r\n//     }\r\n\r\n//     const data = await response.json();\r\n//     return data;\r\n//   } catch (err) {\r\n//     return [];\r\n//   }\r\n// };\r\n", "import './index.css';\r\n\r\nimport { cloneNode } from '@finsweet/ts-utils';\r\n\r\nimport { fetchData } from '$utils/api';\r\nimport type { NewsData } from '$utils/types';\r\nlet oldItems: HTMLLinkElement[] = []; // \u5386\u53F2item\u6570\u7EC4\r\n\r\nwindow.Webflow ||= [];\r\nwindow.Webflow.push(async () => {\r\n  // \u83B7\u53D6search input\u503C\r\n  const urlParams = new URLSearchParams(window.location.search);\r\n  const inputVal = urlParams.get('query');\r\n\r\n  const searchInput = document.querySelector<HTMLInputElement>('[data-element=\"search-input\"]');\r\n\r\n  const searchForm = document.querySelector<HTMLFormElement>('[data-element=\"search-form\"]');\r\n\r\n  const searchInputSide = document.querySelector<HTMLInputElement>(\r\n    '[data-element=\"search-input-side\"]'\r\n  );\r\n  const searchFormSide = document.querySelector<HTMLFormElement>(\r\n    '[data-element=\"search-form-side\"]'\r\n  );\r\n\r\n  if (!searchInput) return;\r\n  if (!searchInputSide) return;\r\n  if (!searchForm) return;\r\n  if (!searchFormSide) return;\r\n  if (inputVal) {\r\n    searchInput.value = inputVal;\r\n    searchInputSide.value = inputVal;\r\n    loadItems(searchInput.value);\r\n  }\r\n\r\n  searchForm.addEventListener('submit', (event) => {\r\n    event.preventDefault();\r\n    const inputVal = searchInput.value;\r\n    // loadItems(searchInput.value);\r\n    // directToSearch();\r\n    window.location.href = `/search?query=${encodeURIComponent(inputVal)}`;\r\n  });\r\n\r\n  searchFormSide?.addEventListener('submit', (event) => {\r\n    event.preventDefault();\r\n    if (!searchInputSide) return;\r\n    const inputVal = searchInputSide.value;\r\n    window.location.href = `/search?query=${encodeURIComponent(inputVal)}`;\r\n  });\r\n  // const item = cloneNode(url);\r\n  // search_container?.append(item);\r\n\r\n  // loadItems(oldPageIndex); // \u52A0\u8F7Ditem\u6570\u7EC4\r\n  // setInterval(updatePage, 5000); // \u9875\u9762\u66F4\u65B0\u5224\u65AD\u6BCF5\u79D2\u4E00\u6B21\r\n});\r\n\r\n/**\r\n * \u521B\u5EFA\u6D88\u606Fitem\r\n * @param param0 \u4E00\u4E2A{@link newsData}\u5BF9\u8C61\r\n * @param itemTemplate webflow\u6A21\u677F\r\n * @returns \u4E00\u4E2A{@link HTMLDivElement}\u5BF9\u8C61\r\n */\r\nconst createNewsItem = (\r\n  { url, title, content, org, p_date }: NewsData,\r\n  itemTemplate: HTMLLinkElement\r\n) => {\r\n  const item = cloneNode(itemTemplate);\r\n  // const linkElement = item.querySelector<HTMLLinkElement>('[data-element=\"search-link\"]');\r\n  const titleElement = item.querySelector<HTMLHeadingElement>('[data-element=\"search-title\"]');\r\n  const orgElement = item.querySelector<HTMLDivElement>('[data-element=\"search-org\"]');\r\n  const dateElement = item.querySelector<HTMLParagraphElement>('[data-element=\"search-date\"]');\r\n  const snippetElement = item.querySelector<HTMLDivElement>('[data-element=\"search-snippet\"]');\r\n\r\n  // \u8D4B\u503C\r\n  if (item) {\r\n    item.href = url;\r\n  }\r\n  if (titleElement) {\r\n    titleElement.innerHTML = title;\r\n  }\r\n  if (orgElement) {\r\n    orgElement.textContent = org;\r\n  }\r\n  if (dateElement) {\r\n    dateElement.textContent = p_date;\r\n  }\r\n  if (snippetElement) {\r\n    snippetElement.innerHTML = content;\r\n  }\r\n  item.removeAttribute('data-cloak'); // \u79FB\u9664\u906E\u6321style\r\n  return item;\r\n};\r\n\r\n/**\r\n * \u7F57\u5217\u5E76\u5448\u73B0items\r\n * @param page \u5F53\u524D\u9875\r\n * @returns \u5F02\u5E38\u8FD4\u56DE\r\n */\r\nconst loadItems = async (searchInput: string) => {\r\n  // \u83B7\u53D6search input\r\n\r\n  // \u83B7\u53D6item json\u6570\u636E\r\n  const newsData: NewsData[] = await fetchData<NewsData>(\r\n    `http://metro-info.edwardxwliu.cn:5000/query?value=${searchInput}`\r\n  );\r\n  // \u6709\u5F02\u5E38\u6216\u6CA1\u6709\u6570\u636E\u8FD4\u56DE\u5230\u6839\u76EE\u5F55\r\n  if (!newsData) {\r\n    window.location.replace('/');\r\n    return;\r\n  }\r\n\r\n  const itemTemplate = document.querySelector<HTMLLinkElement>('[data-element=\"search-link\"]');\r\n\r\n  if (!itemTemplate) return;\r\n  const itemList = document.querySelector<HTMLDivElement>('[data-element=\"search-grid\"]'); // \u83B7\u53D6webflow\u6A21\u677F\r\n  if (!itemList) return;\r\n\r\n  const newsItems = newsData.map((data) => createNewsItem(data, itemTemplate)); // \u4F7F\u7528\u6A21\u677F\u521D\u59CB\u5316item\u6570\u636E\r\n\r\n  if (oldItems) {\r\n    oldItems.map((child) => itemList.removeChild(child));\r\n  }\r\n\r\n  itemTemplate.remove(); // \u5220\u9664\u6A21\u677F\r\n  const secondItemTemplate = document.querySelector<HTMLLinkElement>(\r\n    '[data-element=\"search-link\"]'\r\n  );\r\n  if (secondItemTemplate) secondItemTemplate.remove(); // \u5220\u9664\u6A21\u677F\r\n\r\n  itemList.append(...newsItems); // \u7ED9itemList\u8FFD\u52A0\u65B0\u6570\u636E\r\n  oldItems = newsItems; // \u66F4\u65B0\u4FDD\u5B58\u5386\u53F2\u6570\u636E\r\n};\r\n"],
  "mappings": "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",
  "names": ["inputVal"]
}
