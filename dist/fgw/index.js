"use strict";(()=>{var u=(e,t=!0)=>e.cloneNode(t);async function d(e){try{let t=await fetch(e);return t.ok?await t.json():[]}catch{return[]}}function f(){window.scrollTo({top:0,behavior:"smooth"})}function M(){let e=document.querySelector('[data-element="search-input-side"]'),t=document.querySelector('[data-element="search-form-side"]');t&&t.addEventListener("submit",n=>{if(n.preventDefault(),!e)return;let r=e.value;window.location.href=`/search.html?query=${encodeURIComponent(r)}`})}var m=1,E=1,y=10,v=[],a=1,T=0,x=10,l=Math.floor(x/2),g=null,h="fgw";window.Webflow||(window.Webflow=[]);window.Webflow.push(async()=>{M();let e=await d(`http://metro-info.edwardxwliu.cn:5000/stat?key=${h}&per_page=${y}`);a=e[0].tot_pages,T=e[0].tot_items,c(m),q(),setInterval(_,5e3)});async function _(){if(E===1){let e=await d(`http://metro-info.edwardxwliu.cn:5000/stat?key=${h}&per_page=${y}`),t=e[0].tot_items;t!==T&&(T=t,a=e[0].tot_pages,c(E))}}function q(){let e=document.querySelector('[data-element="next-page"]'),t=document.querySelector('[data-element="previous-page"]');e&&e.addEventListener("click",()=>{c(m+1),f()}),t&&t.addEventListener("click",()=>{c(m-1),f()})}var k=(e,t)=>{let n=u(t);return n&&(n.textContent=e.toString(),n.setAttribute("page-nav-index",e.toString())),n.addEventListener("click",()=>{g||(g=window.setTimeout(()=>{g=null,n.disabled||(c(e),f())},500))}),n},p=async(e,t)=>{let n=document.querySelector('[data-element="page-index"]');if(!n)return;let r=n.parentElement;n.remove(),n.classList.remove("page-index_active");for(let o=e;o<=t;o++)r.append(k(o,n))},B=({type:e,title:t,url:n,preview:r,p_date:o,org:s},H)=>{let i=u(H),L=i.querySelector('[data-element="news-type"]'),w=i.querySelector('[data-element="news-title"]'),D=i.querySelector('[data-element="news-preview'),N=i.querySelector('[data-element="news-org"]'),I=i.querySelector('[data-element="news-date"]');return L&&(L.textContent=e),w&&(w.textContent=t,w.href=n),D&&(D.innerHTML=r),N&&(N.textContent=s),I&&(I.textContent=o),i.removeAttribute("data-cloak"),i},c=async e=>{if(E=e,e<1||e>a)return;let t=await d(`http://metro-info.edwardxwliu.cn:5000/search?key=${h}&page=${e}&per_page=${y}`);if(!t){window.location.replace("/");return}let n=document.querySelector('[data-element="news-item"]');if(!n)return;let r=n.parentElement,o=t.map(s=>B(s,n));v&&v.map(s=>r.removeChild(s)),n.remove(),r.append(...o),v=o,$(e),m=e};function $(e){a>1&&(F(e),a<=x?p(1,a):e+l>a?p(a-x+1,a):e<=l?p(1,x):e>l&&p(e-l,e+l)),b(e),e!==m&&S(m),e===1?b(0):S(0),e===a?b(-1):S(-1)}var b=e=>{let t=document.querySelector(`[page-nav-index="${e}"]`);t?.classList.add("page-index_active"),t&&(t.disabled=!0)},S=e=>{let t=document.querySelector(`[page-nav-index="${e}"]`);t?.classList.remove("page-index_active"),t&&(t.disabled=!1)},C=e=>{document.querySelector(`[page-nav-index="${e}"]`)?.remove()},F=e=>{let t=document.querySelector('[data-element="page-index-wrap"]');if(!t)return;let n=t.firstElementChild?.getAttribute("page-nav-index"),r=t.lastElementChild?.getAttribute("page-nav-index");if(n&&r)for(let o=+n;o<=+r;o++)o!==e&&C(o)};})();
