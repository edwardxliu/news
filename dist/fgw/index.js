"use strict";(()=>{var u=(e,t=!0)=>e.cloneNode(t);async function d(e){try{let t=await fetch(e);return t.ok?await t.json():[]}catch{return[]}}function f(){window.scrollTo({top:0,behavior:"smooth"})}var m=1,T=1,y=10,v=[],r=1,S=0,x=10,s=Math.floor(x/2),g=null,L="fgw";window.Webflow||(window.Webflow=[]);window.Webflow.push(async()=>{let e=await d(`http://metro-info.edwardxwliu.cn:5000/stat?key=${L}&per_page=${y}`);r=e[0].tot_pages,S=e[0].tot_items,c(m),I(),setInterval(H,5e3)});async function H(){if(T===1){let e=await d(`http://metro-info.edwardxwliu.cn:5000/stat?key=${L}&per_page=${y}`),t=e[0].tot_items;t!==S&&(S=t,r=e[0].tot_pages,c(T))}}function I(){let e=document.querySelector('[data-element="next-page"]'),t=document.querySelector('[data-element="previous-page"]');e&&e.addEventListener("click",()=>{c(m+1),f()}),t&&t.addEventListener("click",()=>{c(m-1),f()})}var k=(e,t)=>{let n=u(t);return n&&(n.textContent=e.toString(),n.setAttribute("page-nav-index",e.toString())),n.addEventListener("click",()=>{g||(g=window.setTimeout(()=>{g=null,n.disabled||(c(e),f())},500))}),n},p=async(e,t)=>{let n=document.querySelector('[data-element="page-index"]');if(!n)return;let a=n.parentElement;n.remove(),n.classList.remove("page-index_active");for(let o=e;o<=t;o++)a.append(k(o,n))},B=({type:e,title:t,url:n,preview:a,p_date:o,org:l},_)=>{let i=u(_),D=i.querySelector('[data-element="news-type"]'),w=i.querySelector('[data-element="news-title"]'),h=i.querySelector('[data-element="news-preview'),N=i.querySelector('[data-element="news-org"]'),M=i.querySelector('[data-element="news-date"]');return D&&(D.textContent=e),w&&(w.textContent=t,w.href=n),h&&(h.innerHTML=a),N&&(N.textContent=l),M&&(M.textContent=o),i.removeAttribute("data-cloak"),i},c=async e=>{if(T=e,e<1||e>r)return;let t=await d(`http://metro-info.edwardxwliu.cn:5000/search?key=${L}&page=${e}&per_page=${y}`);if(!t){window.location.replace("/");return}let n=document.querySelector('[data-element="news-item"]');if(!n)return;let a=n.parentElement,o=t.map(l=>B(l,n));v&&v.map(l=>a.removeChild(l)),n.remove(),a.append(...o),v=o,q(e),m=e};function q(e){r>1&&(C(e),r<=x?p(1,r):e+s>r?p(r-x+1,r):e<=s?p(1,x):e>s&&p(e-s,e+s)),b(e),e!==m&&E(m),e===1?b(0):E(0),e===r?b(-1):E(-1)}var b=e=>{let t=document.querySelector(`[page-nav-index="${e}"]`);t?.classList.add("page-index_active"),t&&(t.disabled=!0)},E=e=>{let t=document.querySelector(`[page-nav-index="${e}"]`);t?.classList.remove("page-index_active"),t&&(t.disabled=!1)},$=e=>{document.querySelector(`[page-nav-index="${e}"]`)?.remove()},C=e=>{let t=document.querySelector('[data-element="page-index-wrap"]');if(!t)return;let n=t.firstElementChild?.getAttribute("page-nav-index"),a=t.lastElementChild?.getAttribute("page-nav-index");if(n&&a)for(let o=+n;o<=+a;o++)o!==e&&$(o)};})();
