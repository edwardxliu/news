"use strict";(()=>{var u=(e,t=!0)=>e.cloneNode(t);async function d(e){try{let t=await fetch(e);return t.ok?await t.json():[]}catch{return[]}}function p(){window.scrollTo({top:0,behavior:"smooth"})}function N(){let e=document.querySelector('[data-element="search-input-side"]'),t=document.querySelector('[data-element="search-form-side"]');t&&t.addEventListener("submit",n=>{if(n.preventDefault(),!e)return;let r=e.value;window.location.href=`/search?query=${encodeURIComponent(r)}`})}var m=1,S=1,T=10,w=[],a=1,E=0,x=10,l=Math.floor(x/2),v=null,h="wechat";window.Webflow||(window.Webflow=[]);window.Webflow.push(async()=>{N();let e=await d(`http://metro-info.edwardxwliu.cn:5000/stat?key=${h}&per_page=${T}`);a=e[0].tot_pages,E=e[0].tot_items,c(m),H(),setInterval(M,5e3)});async function M(){if(S===1){let e=await d(`http://metro-info.edwardxwliu.cn:5000/stat?key=${h}&per_page=${T}`),t=e[0].tot_items;t!==E&&(E=t,a=e[0].tot_pages,c(S))}}function H(){let e=document.querySelector('[data-element="next-page"]'),t=document.querySelector('[data-element="previous-page"]');e&&e.addEventListener("click",()=>{c(m+1),p()}),t&&t.addEventListener("click",()=>{c(m-1),p()})}var _=(e,t)=>{let n=u(t);return n&&(n.textContent=e.toString(),n.setAttribute("page-nav-index",e.toString())),n.addEventListener("click",()=>{v||(v=window.setTimeout(()=>{v=null,n.disabled||(c(e),p())},500))}),n},f=async(e,t)=>{let n=document.querySelector('[data-element="page-index"]');if(!n)return;let r=n.parentElement;n.remove(),n.classList.remove("page-index_active");for(let o=e;o<=t;o++)r.append(_(o,n))},k=({title:e,pic_url:t,url:n,p_date:r,content:o},s)=>{let i=u(s);i.href=n;let y=i.querySelector('[data-element="news-title"]'),L=i.querySelector('[data-element="news-preview'),D=i.querySelector('[data-element="news-date"]'),I=i.querySelector('[data-element="news-img-preview"]');return y&&(y.textContent=e),L&&(L.textContent=o),D&&(D.textContent=r),I&&(I.src=t),i.removeAttribute("data-cloak"),i},c=async e=>{if(S=e,e<1||e>a)return;let t=await d(`http://metro-info.edwardxwliu.cn:5000/search?key=${h}&page=${e}&per_page=${T}`);if(!t){window.location.replace("/");return}let n=document.querySelector('[data-element="news-item"]');if(!n)return;let r=n.parentElement,o=t.map(s=>k(s,n));w&&w.map(s=>r.removeChild(s)),n.remove(),r.append(...o),w=o,q(e),m=e};function q(e){a>1&&($(e),a<=x?f(1,a):e+l>a?f(a-x+1,a):e<=l?f(1,x):e>l&&f(e-l,e+l)),g(e),e!==m&&b(m),e===1?g(0):b(0),e===a?g(-1):b(-1)}var g=e=>{let t=document.querySelector(`[page-nav-index="${e}"]`);t?.classList.add("page-index_active"),t&&(t.disabled=!0)},b=e=>{let t=document.querySelector(`[page-nav-index="${e}"]`);t?.classList.remove("page-index_active"),t&&(t.disabled=!1)},B=e=>{document.querySelector(`[page-nav-index="${e}"]`)?.remove()},$=e=>{let t=document.querySelector('[data-element="page-index-wrap"]');if(!t)return;let n=t.firstElementChild?.getAttribute("page-nav-index"),r=t.lastElementChild?.getAttribute("page-nav-index");if(n&&r)for(let o=+n;o<=+r;o++)o!==e&&B(o)};})();
