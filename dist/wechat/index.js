"use strict";(()=>{var u=(e,t=!0)=>e.cloneNode(t);async function d(e){try{let t=await fetch(e);return t.ok?await t.json():[]}catch{return[]}}function f(){window.scrollTo({top:0,behavior:"smooth"})}var m=1,E=1,T=10,w=[],r=1,S=0,x=10,l=Math.floor(x/2),v=null,y="wechat";window.Webflow||(window.Webflow=[]);window.Webflow.push(async()=>{let e=await d(`http://metro-info.edwardxwliu.cn:5000/stat?key=${y}&per_page=${T}`);r=e[0].tot_pages,S=e[0].tot_items,c(m),_(),setInterval(I,5e3)});async function I(){if(E===1){let e=await d(`http://metro-info.edwardxwliu.cn:5000/stat?key=${y}&per_page=${T}`),t=e[0].tot_items;t!==S&&(S=t,r=e[0].tot_pages,c(E))}}function _(){let e=document.querySelector('[data-element="next-page"]'),t=document.querySelector('[data-element="previous-page"]');e&&e.addEventListener("click",()=>{c(m+1),f()}),t&&t.addEventListener("click",()=>{c(m-1),f()})}var k=(e,t)=>{let n=u(t);return n&&(n.textContent=e.toString(),n.setAttribute("page-nav-index",e.toString())),n.addEventListener("click",()=>{v||(v=window.setTimeout(()=>{v=null,n.disabled||(c(e),f())},500))}),n},p=async(e,t)=>{let n=document.querySelector('[data-element="page-index"]');if(!n)return;let a=n.parentElement;n.remove(),n.classList.remove("page-index_active");for(let o=e;o<=t;o++)a.append(k(o,n))},M=({title:e,pic_url:t,url:n,p_date:a,content:o},s)=>{let i=u(s);i.href=n;let L=i.querySelector('[data-element="news-title"]'),h=i.querySelector('[data-element="news-preview'),N=i.querySelector('[data-element="news-date"]'),D=i.querySelector('[data-element="news-img-preview"]');return L&&(L.textContent=e),h&&(h.textContent=o),N&&(N.textContent=a),D&&(D.src=t),i.removeAttribute("data-cloak"),i},c=async e=>{if(E=e,e<1||e>r)return;let t=await d(`http://metro-info.edwardxwliu.cn:5000/search?key=${y}&page=${e}&per_page=${T}`);if(!t){window.location.replace("/");return}let n=document.querySelector('[data-element="news-item"]');if(!n)return;let a=n.parentElement,o=t.map(s=>M(s,n));w&&w.map(s=>a.removeChild(s)),n.remove(),a.append(...o),w=o,H(e),m=e};function H(e){r>1&&($(e),r<=x?p(1,r):e+l>r?p(r-x+1,r):e<=l?p(1,x):e>l&&p(e-l,e+l)),g(e),e!==m&&b(m),e===1?g(0):b(0),e===r?g(-1):b(-1)}var g=e=>{let t=document.querySelector(`[page-nav-index="${e}"]`);t?.classList.add("page-index_active"),t&&(t.disabled=!0)},b=e=>{let t=document.querySelector(`[page-nav-index="${e}"]`);t?.classList.remove("page-index_active"),t&&(t.disabled=!1)},B=e=>{document.querySelector(`[page-nav-index="${e}"]`)?.remove()},$=e=>{let t=document.querySelector('[data-element="page-index-wrap"]');if(!t)return;let n=t.firstElementChild?.getAttribute("page-nav-index"),a=t.lastElementChild?.getAttribute("page-nav-index");if(n&&a)for(let o=+n;o<=+a;o++)o!==e&&B(o)};})();
