"use strict";(()=>{var x=(e,t=!0)=>e.cloneNode(t);async function w(e){try{let t=await fetch(e);return t.ok?await t.json():[]}catch{return[]}}function v(){let e=Date.now(),t=new Date(e),r=String(t.getMonth()+1).padStart(2,"0"),o=String(t.getDate()).padStart(2,"0");return`${t.getFullYear()}-${r}-${o}`}var y=1,E=1,g=10,D=v(),h=class{constructor(t){this.variables={};this.variables=t}setValue(t,r){t in this.variables?this.variables[t]=r:console.log(`No such variable '${t}' found`)}getValue(t){return this.variables[t]}},d=new h({fgwTotItems:0,wechatTotItems:0,gzdtTotItems:0,fgwOldItemsHistory:[],fgwOldItemsToday:[],wechatOldItemsHistory:[],wechatOldItemsToday:[],gzdtOldItemsHistory:[],gzdtOldItemsToday:[]});window.Webflow||(window.Webflow=[]);window.Webflow.push(()=>{T("fgw","fgwTotItems","fgwOldItemsToday","fgwOldItemsHistory"),T("wechat","wechatTotItems","wechatOldItemsToday","wechatOldItemsHistory"),T("gzdt","gzdtTotItems","gzdtOldItemsToday","gzdtOldItemsHistory")});async function T(e,t,r,o){let n=await w(`http://metro-info.edwardxwliu.cn:5000/stat?key=${e}&per_page=${g}`);d.setValue(t,n[0].tot_items),H(e,y,r,o),setInterval(()=>$(e,t,r,o),5e3)}async function $(e,t,r,o){if(E===1){let s=(await w(`http://metro-info.edwardxwliu.cn:5000/stat?key=${e}&per_page=${g}`))[0].tot_items,l=d.getValue(t);s!==l&&(d.setValue(t,s),H(e,y,r,o))}}var I=(e,{type:t,title:r,pic_url:o,url:n,p_date:s},l)=>{let a=x(l),p=a.querySelector(`[data-element="${e}-type"]`),f=a.querySelector(`[data-element="${e}-title"]`),i=a.querySelector(`[data-element="${e}-date"]`),m=a.querySelector(`[data-element="${e}-img-preview"]`);return p&&(p.textContent=t),f&&(f.textContent=r,f.href=n),i&&(i.textContent=s),m&&(m.src=o),a.removeAttribute("data-cloak"),a},H=async(e,t,r,o)=>{if(E=t,t<1)return;let n=await w(`http://metro-info.edwardxwliu.cn:5000/search?key=${e}&page=${t}&per_page=${g}&date=${D}&today=1`),s=await w(`http://metro-info.edwardxwliu.cn:5000/search?key=${e}&page=${t}&per_page=${g}&date=${D}`);if(!s){window.location.replace("/");return}let l=document.querySelector(`[data-element="${e}-item-today"]`),a=document.querySelector(`[data-element="${e}-item-history"]`),p=document.querySelector(`[data-element="${e}-more-today"]`),f=document.querySelector(`[data-element="${e}-more-history"]`);if(!(!l||!a||!p||!f)){if(p.hidden=n.length<10,n.length>0){let i=l.parentElement,m=n.map(c=>I(e,c,l)),u=d.getValue(r);u&&u.map(c=>i.removeChild(c)),i.append(...m),d.setValue(r,m)}if(s.length>0){let i=a.parentElement,m=s.map(c=>I(e,c,a)),u=d.getValue(o);u&&u.map(c=>i.removeChild(c)),i.append(...m),d.setValue(o,m)}y=t}};})();
