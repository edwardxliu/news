"use strict";(()=>{var x=(e,t=!0)=>e.cloneNode(t);async function w(e){try{let t=await fetch(e);return t.ok?await t.json():[]}catch{return[]}}function v(){let e=Date.now(),t=new Date(e),o=String(t.getMonth()+1).padStart(2,"0"),r=String(t.getDate()).padStart(2,"0");return`${t.getFullYear()}-${o}-${r}`}var y=1,E=1,g=10,D=v(),h=class{constructor(t){this.variables={};this.variables=t}setValue(t,o){t in this.variables?this.variables[t]=o:console.log(`No such variable '${t}' found`)}getValue(t){return this.variables[t]}},d=new h({fgwTotItems:0,wechatTotItems:0,gzdtTotItems:0,fgwOldItemsHistory:[],fgwOldItemsToday:[],wechatOldItemsHistory:[],wechatOldItemsToday:[],gzdtOldItemsHistory:[],gzdtOldItemsToday:[]});window.Webflow||(window.Webflow=[]);window.Webflow.push(()=>{T("fgw","fgwTotItems","fgwOldItemsToday","fgwOldItemsHistory"),T("wechat","wechatTotItems","wechatOldItemsToday","wechatOldItemsHistory"),T("gzdt","gzdtTotItems","gzdtOldItemsToday","gzdtOldItemsHistory");let e=document.querySelector('[data-element="search-input"]'),t=document.querySelector('[data-element="search-button"]');console.log(e,t)});async function T(e,t,o,r){let n=await w(`http://metro-info.edwardxwliu.cn:5000/stat?key=${e}&per_page=${g}`);d.setValue(t,n[0].tot_items),H(e,y,o,r),setInterval(()=>b(e,t,o,r),5e3)}async function b(e,t,o,r){if(E===1){let s=(await w(`http://metro-info.edwardxwliu.cn:5000/stat?key=${e}&per_page=${g}`))[0].tot_items,l=d.getValue(t);s!==l&&(d.setValue(t,s),H(e,y,o,r))}}var I=(e,{type:t,title:o,pic_url:r,url:n,p_date:s},l)=>{let a=x(l),p=a.querySelector(`[data-element="${e}-type"]`),u=a.querySelector(`[data-element="${e}-title"]`),i=a.querySelector(`[data-element="${e}-date"]`),m=a.querySelector(`[data-element="${e}-img-preview"]`);return p&&(p.textContent=t),u&&(u.textContent=o,u.href=n),i&&(i.textContent=s),m&&(m.src=r),a.removeAttribute("data-cloak"),a},H=async(e,t,o,r)=>{if(E=t,t<1)return;let n=await w(`http://metro-info.edwardxwliu.cn:5000/search?key=${e}&page=${t}&per_page=${g}&date=${D}&today=1`),s=await w(`http://metro-info.edwardxwliu.cn:5000/search?key=${e}&page=${t}&per_page=${g}&date=${D}`);if(!s){window.location.replace("/");return}let l=document.querySelector(`[data-element="${e}-item-today"]`),a=document.querySelector(`[data-element="${e}-item-history"]`),p=document.querySelector(`[data-element="${e}-more-today"]`),u=document.querySelector(`[data-element="${e}-more-history"]`);if(!(!l||!a||!p||!u)){if(p.hidden=n.length<10,n.length>0){let i=l.parentElement,m=n.map(c=>I(e,c,l)),f=d.getValue(o);f&&f.map(c=>i.removeChild(c)),i.append(...m),d.setValue(o,m)}if(s.length>0){let i=a.parentElement,m=s.map(c=>I(e,c,a)),f=d.getValue(r);f&&f.map(c=>i.removeChild(c)),i.append(...m),d.setValue(r,m)}y=t}};})();
