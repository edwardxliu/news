"use strict";(()=>{var x=(t,e=!0)=>t.cloneNode(e);async function w(t){try{let e=await fetch(t);return e.ok?await e.json():[]}catch{return[]}}function v(){let t=Date.now(),e=new Date(t),r=String(e.getMonth()+1).padStart(2,"0"),o=String(e.getDate()).padStart(2,"0");return`${e.getFullYear()}-${r}-${o}`}var T=1,$=1,g=10,D=v(),h=class{constructor(e){this.variables={};this.variables=e}setValue(e,r){e in this.variables?this.variables[e]=r:console.log(`No such variable '${e}' found`)}getValue(e){return this.variables[e]}},d=new h({fgwTotItems:0,wechatTotItems:0,fgwOldItemsHistory:[],fgwOldItemsToday:[],wechatOldItemsHistory:[],wechatOldItemsToday:[]});window.Webflow||(window.Webflow=[]);window.Webflow.push(()=>{y("fgw","fgwTotItems","fgwOldItemsToday","fgwOldItemsHistory"),y("wechat","wechatTotItems","wechatOldItemsToday","wechatOldItemsHistory")});async function y(t,e,r,o){let n=await w(`http://metro-info.edwardxwliu.cn:5000/stat?key=${t}&per_page=${g}`);d.setValue(e,n[0].tot_items),b(t,T,r,o),setInterval(()=>H(t,e,r,o),5e3)}async function H(t,e,r,o){if($===1){let s=(await w(`http://metro-info.edwardxwliu.cn:5000/stat?key=${t}&per_page=${g}`))[0].tot_items,l=d.getValue(e);s!==l&&(d.setValue(e,s),b(t,T,r,o))}}var E=(t,{type:e,title:r,pic_url:o,url:n,p_date:s},l)=>{let a=x(l),p=a.querySelector(`[data-element="${t}-type"]`),f=a.querySelector(`[data-element="${t}-title"]`),i=a.querySelector(`[data-element="${t}-date"]`),m=a.querySelector(`[data-element="${t}-img-preview"]`);return p&&(p.textContent=e),f&&(f.textContent=r,f.href=n),i&&(i.textContent=s),m&&(m.src=o),a.removeAttribute("data-cloak"),a},b=async(t,e,r,o)=>{if($=e,e<1)return;let n=await w(`http://metro-info.edwardxwliu.cn:5000/search?key=${t}&page=${e}&per_page=${g}&date=${D}&today=1`),s=await w(`http://metro-info.edwardxwliu.cn:5000/search?key=${t}&page=${e}&per_page=${g}&date=${D}`);if(!s){window.location.replace("/");return}let l=document.querySelector(`[data-element="${t}-item-today"]`),a=document.querySelector(`[data-element="${t}-item-history"]`),p=document.querySelector(`[data-element="${t}-more-today"]`),f=document.querySelector(`[data-element="${t}-more-history"]`);if(!(!l||!a||!p||!f)){if(p.hidden=n.length<10,n.length>0){let i=l.parentElement,m=n.map(c=>E(t,c,l)),u=d.getValue(r);u&&u.map(c=>i.removeChild(c)),i.append(...m),d.setValue(r,m)}if(s.length>0){let i=a.parentElement,m=s.map(c=>E(t,c,a)),u=d.getValue(o);u&&u.map(c=>i.removeChild(c)),i.append(...m),d.setValue(o,m)}T=e}};})();
