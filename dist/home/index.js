"use strict";(()=>{async function w(t){try{let e=await fetch(t);return e.ok?await e.json():[]}catch{return[]}}function S(){let t=Date.now(),e=new Date(t),n=String(e.getMonth()+1).padStart(2,"0"),o=String(e.getDate()).padStart(2,"0");return`${e.getFullYear()}-${n}-${o}`}function v(){let t=document.querySelector('[data-element="search-input-side"]'),e=document.querySelector('[data-element="search-form-side"]');e&&e.addEventListener("submit",n=>{if(n.preventDefault(),!t)return;let o=t.value;window.location.href=`/search.html?query=${encodeURIComponent(o)}`})}var y=(t,e=!0)=>t.cloneNode(e);var M=10,W=Math.floor(M/2);var E=(t,{type:e,title:n,pic_url:o,url:i,p_date:s,org:m,preview:p,content:d},g)=>{let r=y(g),h=document.querySelector('[data-element="main-wraper"]'),l=r.querySelector('[data-element="news-type"]'),c=r.querySelector('[data-element="news-title"]'),a=r.querySelector('[data-element="news-preview'),f=r.querySelector('[data-element="news-date"]'),x=r.querySelector('[data-element="news-img-preview"]');if(r.href=i,l&&(l.textContent=e||m),c&&(c.textContent=n),a&&(!p&&!d&&(d=n),a.textContent=p||d.slice(0,200)),f&&(f.textContent=s),x)switch(t){case"gzdt":x.src=o||"http://qn.edwardxwliu.cn/%E7%88%AC%E8%99%AB/gzdt.jpg";break;case"fgw":x.src=o||"http://qn.edwardxwliu.cn/%E7%88%AC%E8%99%AB/fgw.jpg";break;default:x.src=o;break}return r.removeAttribute("data-cloak"),h?.removeAttribute("data-cloak"),r};var I=1,H=1,T=10,D=S(),L=class{constructor(e){this.variables={};this.variables=e}setValue(e,n){e in this.variables?this.variables[e]=n:console.log(`No such variable '${e}' found`)}getValue(e){return this.variables[e]}},u=new L({fgwTotItems:0,wechatTotItems:0,gzdtTotItems:0,fgwOldItemsHistory:[],fgwOldItemsToday:[],wechatOldItemsHistory:[],wechatOldItemsToday:[],gzdtOldItemsHistory:[],gzdtOldItemsToday:[]});window.Webflow||(window.Webflow=[]);window.Webflow.push(()=>{v(),b("fgw","fgwTotItems","fgwOldItemsToday","fgwOldItemsHistory"),b("wechat","wechatTotItems","wechatOldItemsToday","wechatOldItemsHistory"),b("gzdt","gzdtTotItems","gzdtOldItemsToday","gzdtOldItemsHistory")});async function b(t,e,n,o){let i=await w(`http://metro-info.edwardxwliu.cn:5000/stat?key=${t}&per_page=${T}`);u.setValue(e,i[0].tot_items),N(t,I,n,o),setInterval(()=>$(t,e,n,o),5e3)}async function $(t,e,n,o){if(H===1){let s=(await w(`http://metro-info.edwardxwliu.cn:5000/stat?key=${t}&per_page=${T}`))[0].tot_items,m=u.getValue(e);s!==m&&(u.setValue(e,s),N(t,I,n,o))}}var N=async(t,e,n,o)=>{if(H=e,e<1)return;let i=await w(`http://metro-info.edwardxwliu.cn:5000/search?key=${t}&page=${e}&per_page=${T}&date=${D}&today=1`),s=await w(`http://metro-info.edwardxwliu.cn:5000/search?key=${t}&page=${e}&per_page=${T}&date=${D}`);if(!s){window.location.replace("/");return}let m=document.querySelector(`[data-element="${t}-itemlist-history"]`),p=document.querySelector(`[data-element="${t}-itemlist-today"]`);if(!(m&&p))return;let d=p.firstChild,g=m.firstChild,r=document.querySelector(`[data-element="${t}-more-today"]`),h=document.querySelector(`[data-element="${t}-more-history"]`);if(!(!d||!g||!r||!h)){if(r.hidden=i.length<10,i.length>0){let l=d.parentElement,c=i.map(f=>E(t,f,d)),a=u.getValue(n);a&&a.map(f=>l.removeChild(f)),l.append(...c),u.setValue(n,c)}if(s.length>0){let l=s.map(a=>E(t,a,g)),c=u.getValue(o);c&&c.map(a=>m.removeChild(a)),m.append(...l),u.setValue(o,l)}I=e}};})();
