"use strict";(()=>{var h=(t,e=!0)=>t.cloneNode(e);async function w(t){try{let e=await fetch(t);return e.ok?await e.json():[]}catch{return[]}}function v(){let t=Date.now(),e=new Date(t),o=String(e.getMonth()+1).padStart(2,"0"),r=String(e.getDate()).padStart(2,"0");return`${e.getFullYear()}-${o}-${r}`}function D(){let t=document.querySelector('[data-element="search-input-side"]'),e=document.querySelector('[data-element="search-form-side"]');e&&e.addEventListener("submit",o=>{if(o.preventDefault(),!t)return;let r=t.value;window.location.href=`/search?query=${encodeURIComponent(r)}`})}var y=1,S=1,g=10,I=v(),T=class{constructor(e){this.variables={};this.variables=e}setValue(e,o){e in this.variables?this.variables[e]=o:console.log(`No such variable '${e}' found`)}getValue(e){return this.variables[e]}},d=new T({fgwTotItems:0,wechatTotItems:0,gzdtTotItems:0,fgwOldItemsHistory:[],fgwOldItemsToday:[],wechatOldItemsHistory:[],wechatOldItemsToday:[],gzdtOldItemsHistory:[],gzdtOldItemsToday:[]});window.Webflow||(window.Webflow=[]);window.Webflow.push(()=>{D(),x("fgw","fgwTotItems","fgwOldItemsToday","fgwOldItemsHistory"),x("wechat","wechatTotItems","wechatOldItemsToday","wechatOldItemsHistory"),x("gzdt","gzdtTotItems","gzdtOldItemsToday","gzdtOldItemsHistory");let t=document.querySelector('[data-element="search-input"]'),e=document.querySelector('[data-element="search-button"]');console.log(t,e)});async function x(t,e,o,r){let a=await w(`http://metro-info.edwardxwliu.cn:5000/stat?key=${t}&per_page=${g}`);d.setValue(e,a[0].tot_items),H(t,y,o,r),setInterval(()=>b(t,e,o,r),5e3)}async function b(t,e,o,r){if(S===1){let s=(await w(`http://metro-info.edwardxwliu.cn:5000/stat?key=${t}&per_page=${g}`))[0].tot_items,l=d.getValue(e);s!==l&&(d.setValue(e,s),H(t,y,o,r))}}var E=(t,{type:e,title:o,pic_url:r,url:a,p_date:s},l)=>{let n=h(l),p=n.querySelector(`[data-element="${t}-type"]`),u=n.querySelector(`[data-element="${t}-title"]`),i=n.querySelector(`[data-element="${t}-date"]`),m=n.querySelector(`[data-element="${t}-img-preview"]`);return p&&(p.textContent=e),u&&(u.textContent=o,u.href=a),i&&(i.textContent=s),m&&(m.src=r),n.removeAttribute("data-cloak"),n},H=async(t,e,o,r)=>{if(S=e,e<1)return;let a=await w(`http://metro-info.edwardxwliu.cn:5000/search?key=${t}&page=${e}&per_page=${g}&date=${I}&today=1`),s=await w(`http://metro-info.edwardxwliu.cn:5000/search?key=${t}&page=${e}&per_page=${g}&date=${I}`);if(!s){window.location.replace("/");return}let l=document.querySelector(`[data-element="${t}-item-today"]`),n=document.querySelector(`[data-element="${t}-item-history"]`),p=document.querySelector(`[data-element="${t}-more-today"]`),u=document.querySelector(`[data-element="${t}-more-history"]`);if(!(!l||!n||!p||!u)){if(p.hidden=a.length<10,a.length>0){let i=l.parentElement,m=a.map(c=>E(t,c,l)),f=d.getValue(o);f&&f.map(c=>i.removeChild(c)),i.append(...m),d.setValue(o,m)}if(s.length>0){let i=n.parentElement,m=s.map(c=>E(t,c,n)),f=d.getValue(r);f&&f.map(c=>i.removeChild(c)),i.append(...m),d.setValue(r,m)}y=e}};})();
