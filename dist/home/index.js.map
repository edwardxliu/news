{
  "version": 3,
  "sources": ["../../bin/live-reload.js", "../../node_modules/.pnpm/@finsweet+ts-utils@0.40.0/node_modules/@finsweet/ts-utils/dist/helpers/cloneNode.js", "../../src/utils/api.ts", "../../src/home/index.ts"],
  "sourcesContent": ["new EventSource(`${SERVE_ORIGIN}/esbuild`).addEventListener('change', () => location.reload());\r\n", "/**\n * Clone a node that has the same type as the original one\n * @param node\n */\nexport const cloneNode = (node, deep = true) => node.cloneNode(deep);\n", "import type { NewsData } from './types';\r\n\r\n/**\r\n * fetche news data from mysql database\r\n * @param url database url\r\n * @returns a {@link NewsData} object.\r\n */\r\nexport const fetchNewsDatabase = async (url: string): Promise<NewsData[]> => {\r\n  try {\r\n    const response = await fetch(url);\r\n    if (!response.ok) {\r\n      return [];\r\n    }\r\n\r\n    const data: NewsData[] = await response.json();\r\n    return data;\r\n  } catch (err) {\r\n    return [];\r\n  }\r\n};\r\n\r\nexport const fetchNewsStatDatabase = async (url: string) => {\r\n  try {\r\n    const response = await fetch(url);\r\n    if (!response.ok) {\r\n      return [];\r\n    }\r\n\r\n    const data = await response.json();\r\n    return data;\r\n  } catch (err) {\r\n    return [];\r\n  }\r\n};\r\n", "import './index.css';\r\n\r\nimport { cloneNode } from '@finsweet/ts-utils';\r\n\r\nimport { fetchNewsDatabase, fetchNewsStatDatabase } from '$utils/api';\r\nimport type { NewsData } from '$utils/types';\r\n\r\nlet currentPage: number = 1;\r\nconst perPage = 10;\r\nlet oldItems: HTMLDivElement[] = [];\r\n// const itemTemplate = document.querySelector<HTMLDivElement>('[data-element=\"news-item\"]');\r\nlet totPages: number = 1;\r\n// let pre_page:number = 0;\r\n\r\nwindow.Webflow ||= [];\r\nwindow.Webflow.push(async () => {\r\n  const item_stat = await fetchNewsStatDatabase(\r\n    `http://metro-info.edwardxwliu.cn:5000/stat?per_page=${perPage}`\r\n  );\r\n  totPages = item_stat.tot_pages;\r\n  loadItems(currentPage);\r\n\r\n  // create before and next button and add events\r\n  const nextButton = document.querySelector<HTMLButtonElement>('[data-element=\"next-page\"]');\r\n  const previousButton = document.querySelector<HTMLButtonElement>(\r\n    '[data-element=\"previous-page\"]'\r\n  );\r\n\r\n  if (nextButton) {\r\n    nextButton.addEventListener('click', () => {\r\n      loadItems(currentPage + 1);\r\n    });\r\n  }\r\n  if (previousButton) {\r\n    previousButton.addEventListener('click', () => {\r\n      loadItems(currentPage - 1);\r\n    });\r\n  }\r\n\r\n  // create page index buttons\r\n  loadPageIndex(1, 10);\r\n\r\n  // handleNavButtons(currentPage);\r\n});\r\n\r\nconst createPageIndex = (index: number, itemTemplate: HTMLButtonElement) => {\r\n  const item = cloneNode(itemTemplate);\r\n\r\n  if (item) {\r\n    item.textContent = index.toString();\r\n    item.setAttribute('page-nav-index', index.toString());\r\n  }\r\n  item.addEventListener('click', () => {\r\n    if (!item.disabled) {\r\n      loadItems(index);\r\n    }\r\n  });\r\n  return item;\r\n};\r\n\r\nconst loadPageIndex = async (stPage: number, edPage: number) => {\r\n  // find the index template\r\n  const pageIndexTemplate = document.querySelector<HTMLButtonElement>(\r\n    '[data-element=\"page-index\"]'\r\n  );\r\n  if (!pageIndexTemplate) return;\r\n  // find page index wrapper\r\n  const pageIndexList = pageIndexTemplate.parentElement!;\r\n  pageIndexTemplate.remove();\r\n\r\n  for (let i = stPage; i <= edPage; i++) {\r\n    pageIndexList.append(createPageIndex(i, pageIndexTemplate));\r\n  }\r\n};\r\n\r\nconst createNewsItem = (\r\n  { type, title, url, preview, p_date, org }: NewsData,\r\n  itemTemplate: HTMLDivElement\r\n) => {\r\n  const item = cloneNode(itemTemplate);\r\n  const typeElement = item.querySelector<HTMLDivElement>('[data-element=\"news-type\"]');\r\n  const titleElement = item.querySelector<HTMLLinkElement>('[data-element=\"news-title\"]');\r\n  const previewElement = item.querySelector<HTMLDivElement>('[data-element=\"news-preview');\r\n  const orgElement = item.querySelector<HTMLDivElement>('[data-element=\"news-org\"]');\r\n  const dateElement = item.querySelector<HTMLDivElement>('[data-element=\"news-date\"]');\r\n\r\n  // console.log(item, typeElement, titleElement);\r\n  if (typeElement) {\r\n    typeElement.textContent = type;\r\n  }\r\n  if (titleElement) {\r\n    titleElement.textContent = title;\r\n    titleElement.href = url;\r\n  }\r\n  if (previewElement) {\r\n    previewElement.textContent = preview;\r\n  }\r\n  if (orgElement) {\r\n    orgElement.textContent = org;\r\n  }\r\n  if (dateElement) {\r\n    dateElement.textContent = p_date;\r\n  }\r\n\r\n  item.removeAttribute('data-cloak');\r\n  return item;\r\n};\r\n\r\nconst loadItems = async (page: number) => {\r\n  // console.log(page);\r\n\r\n  if (page < 1 || page > totPages) return;\r\n  const newsData = await fetchNewsDatabase(\r\n    `http://metro-info.edwardxwliu.cn:5000/search?page=${page}&per_page=${perPage}`\r\n  );\r\n  if (!newsData) {\r\n    window.location.replace('/');\r\n    return;\r\n  }\r\n\r\n  const itemTemplate = document.querySelector<HTMLDivElement>('[data-element=\"news-item\"]');\r\n  if (!itemTemplate) return;\r\n\r\n  const itemList = itemTemplate.parentElement!;\r\n  // itemTemplate.remove();\r\n\r\n  const newsItems = newsData.map((data) => createNewsItem(data, itemTemplate));\r\n  // console.log(oldItems);\r\n  if (oldItems) {\r\n    oldItems.map((child) => itemList.removeChild(child));\r\n  }\r\n\r\n  itemList.append(...newsItems);\r\n  oldItems = newsItems;\r\n  handleNavButtons(page);\r\n  currentPage = page;\r\n};\r\n\r\nfunction handleNavButtons(page: number) {\r\n  if (page + 4 > totPages) {\r\n    cleanPageIndex(page);\r\n    loadPageIndex(totPages - 9, totPages);\r\n  } else if (page > 6) {\r\n    cleanPageIndex(page);\r\n    loadPageIndex(page - 5, page + 4);\r\n  } else if (page <= 6) {\r\n    cleanPageIndex(page);\r\n    loadPageIndex(1, 10);\r\n  }\r\n  pageButActive(page);\r\n  if (page !== currentPage) {\r\n    pageButInactive(currentPage);\r\n  }\r\n  if (page === 1) {\r\n    pageButActive(0);\r\n  } else {\r\n    pageButInactive(0);\r\n  }\r\n  if (page === totPages) {\r\n    pageButActive(-1);\r\n  } else {\r\n    pageButInactive(-1);\r\n  }\r\n}\r\n\r\nconst pageButActive = (pageIndex: number) => {\r\n  const item = document.querySelector<HTMLButtonElement>(`[page-nav-index=\"${pageIndex}\"]`);\r\n  // console.log(item?.textContent, pageIndex);\r\n  item?.classList.add('page-index_active');\r\n  if (item) item.disabled = true;\r\n};\r\n\r\nconst pageButInactive = (pageIndex: number) => {\r\n  const item = document.querySelector<HTMLButtonElement>(`[page-nav-index=\"${pageIndex}\"]`);\r\n  item?.classList.remove('page-index_active');\r\n  if (item) item.disabled = false;\r\n};\r\n\r\nconst pageButRemove = (pageIndex: number) => {\r\n  const item = document.querySelector<HTMLButtonElement>(`[page-nav-index=\"${pageIndex}\"]`);\r\n  item?.remove();\r\n};\r\n\r\nconst cleanPageIndex = (page: number) => {\r\n  const pageIndexWrap = document.querySelector<HTMLDivElement>('[data-element=\"page-index-wrap\"]');\r\n\r\n  if (!pageIndexWrap) return;\r\n  const st_i = pageIndexWrap.firstElementChild?.getAttribute('page-nav-index');\r\n  const ed_i = pageIndexWrap.lastElementChild?.getAttribute('page-nav-index');\r\n\r\n  if (st_i && ed_i) {\r\n    for (let i: number = +st_i; i <= +ed_i; i++) {\r\n      if (i !== page) pageButRemove(i);\r\n    }\r\n  }\r\n};\r\n"],
  "mappings": "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",
  "names": []
}
