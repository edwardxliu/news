{
  "version": 3,
  "sources": ["../../bin/live-reload.js", "../../node_modules/.pnpm/@finsweet+ts-utils@0.40.0/node_modules/@finsweet/ts-utils/dist/helpers/cloneNode.js", "../../src/utils/api.ts", "../../src/utils/event.ts", "../../src/home/index.ts"],
  "sourcesContent": ["new EventSource(`${SERVE_ORIGIN}/esbuild`).addEventListener('change', () => location.reload());\r\n", "/**\n * Clone a node that has the same type as the original one\n * @param node\n */\nexport const cloneNode = (node, deep = true) => node.cloneNode(deep);\n", "// import type { NewsData } from './types';\r\n\r\n/**\r\n * \u4ECE\u540E\u7AEF\u83B7\u53D6\u6570\u636E\r\n * @param url \u540E\u7AEF\u8BF7\u6C42\u5730\u5740\r\n * @returns json\u6570\u7EC4, \u6CA1\u627E\u5230\u8FD4\u56DE\u7A7A\u6570\u7EC4[]\r\n */\r\n// export const fetchNewsDatabase = async (url: string): Promise<NewsData[]> => {\r\nexport async function fetchData<T>(url: string): Promise<T[]> {\r\n  try {\r\n    const response = await fetch(url);\r\n    if (!response.ok) {\r\n      return [];\r\n    }\r\n\r\n    // const data: NewsData[] = await response.json();\r\n    const data = await response.json();\r\n    return data as T[];\r\n  } catch (err) {\r\n    return [];\r\n  }\r\n}\r\n\r\n/**\r\n * \u4EE5\u56FA\u5B9A\u683C\u5F0F\u8FD4\u56DE\u5F53\u524D\u65E5\u671F\r\n * @returns yyyy-mm-dd\r\n */\r\nexport function getCurrentDate(): string {\r\n  const now = Date.now();\r\n  const date = new Date(now);\r\n  const mth = String(date.getMonth() + 1).padStart(2, '0');\r\n  const day = String(date.getDate()).padStart(2, '0');\r\n\r\n  return `${date.getFullYear()}-${mth}-${day}`;\r\n}\r\n\r\n// export const fetchNewsStatDatabase = async (url: string) => {\r\n//   try {\r\n//     const response = await fetch(url);\r\n//     if (!response.ok) {\r\n//       return [];\r\n//     }\r\n\r\n//     const data = await response.json();\r\n//     return data;\r\n//   } catch (err) {\r\n//     return [];\r\n//   }\r\n// };\r\n", "export function scrollToTop() {\r\n  window.scrollTo({\r\n    top: 0,\r\n    behavior: 'smooth',\r\n  });\r\n}\r\n\r\nexport function directToSearch() {\r\n  const searchInputSide = document.querySelector<HTMLInputElement>(\r\n    '[data-element=\"search-input-side\"]'\r\n  );\r\n  const searchFormSide = document.querySelector<HTMLFormElement>(\r\n    '[data-element=\"search-form-side\"]'\r\n  );\r\n  if (!searchFormSide) return;\r\n  searchFormSide.addEventListener('submit', (event) => {\r\n    event.preventDefault();\r\n    if (!searchInputSide) return;\r\n    const inputVal = searchInputSide.value;\r\n    window.location.href = `/search.html?query=${encodeURIComponent(inputVal)}`;\r\n  });\r\n}\r\n", "import './index.css';\r\n\r\nimport { cloneNode } from '@finsweet/ts-utils';\r\n\r\nimport { fetchData, getCurrentDate } from '$utils/api';\r\nimport { directToSearch } from '$utils/event';\r\nimport type { NewsData, NewsDataStat } from '$utils/types';\r\n\r\nlet oldPageIndex: number = 1; // \u5BFC\u822A\u680F\u5386\u53F2index\r\nlet curPageIndex: number = 1; // \u5BFC\u822A\u680F\u5F53\u524Dindex\r\nconst perPage: number = 10; // \u6BCF\u9875\u663E\u793Aitem\u6570\u91CF\uFF0C\u9ED8\u8BA410\r\nconst currentDate: string = getCurrentDate();\r\n\r\nclass GlobalState {\r\n  private variables: { [key: string]: number | HTMLDivElement[] } = {};\r\n  constructor(initVals: { [key: string]: number | HTMLDivElement[] }) {\r\n    this.variables = initVals;\r\n  }\r\n  setValue(key: string, val: number | HTMLDivElement[]) {\r\n    if (key in this.variables) {\r\n      this.variables[key] = val;\r\n    } else {\r\n      console.log(`No such variable '${key}' found`);\r\n    }\r\n  }\r\n  getValue<T>(key: string): T {\r\n    return this.variables[key] as T;\r\n  }\r\n}\r\n\r\nconst globalState = new GlobalState({\r\n  fgwTotItems: 0,\r\n  wechatTotItems: 0,\r\n  gzdtTotItems: 0,\r\n  fgwOldItemsHistory: [], // \u5386\u53F2item\u6570\u7EC4\r\n  fgwOldItemsToday: [],\r\n  wechatOldItemsHistory: [],\r\n  wechatOldItemsToday: [],\r\n  gzdtOldItemsHistory: [],\r\n  gzdtOldItemsToday: [],\r\n});\r\n\r\nwindow.Webflow ||= [];\r\nwindow.Webflow.push(() => {\r\n  directToSearch();\r\n\r\n  handleNews('fgw', 'fgwTotItems', 'fgwOldItemsToday', 'fgwOldItemsHistory');\r\n  handleNews('wechat', 'wechatTotItems', 'wechatOldItemsToday', 'wechatOldItemsHistory');\r\n  handleNews('gzdt', 'gzdtTotItems', 'gzdtOldItemsToday', 'gzdtOldItemsHistory');\r\n\r\n  const searchInput = document.querySelector<HTMLInputElement>('[data-element=\"search-input\"]');\r\n  const searchButton = document.querySelector<HTMLButtonElement>('[data-element=\"search-button\"]');\r\n  console.log(searchInput, searchButton);\r\n});\r\n\r\nasync function handleNews(key: string, glTotItems: string, glbToday: string, glbHistory: string) {\r\n  // \u83B7\u53D6\u6570\u636E\u603B\u6570\u91CF\u548C\u603B\u5206\u9875\u6570\uFF0C\u5206\u9875\u901A\u8FC7perPage\u8BA1\u7B97\u3002\r\n  const item_stat: NewsDataStat[] = await fetchData<NewsDataStat>(\r\n    `http://metro-info.edwardxwliu.cn:5000/stat?key=${key}&per_page=${perPage}`\r\n  );\r\n  globalState.setValue(glTotItems, item_stat[0].tot_items);\r\n  loadItems(key, oldPageIndex, glbToday, glbHistory); // \u52A0\u8F7Ditem\u6570\u7EC4\r\n  setInterval(() => updateNews(key, glTotItems, glbToday, glbHistory), 5000); // \u9875\u9762\u66F4\u65B0\u5224\u65AD\u6BCF5\u79D2\u4E00\u6B21\r\n}\r\n\r\n/**\r\n * \u901A\u8FC7\u5224\u65ADitem\u603B\u6570\u7684\u53D8\u5316\u6765\u51B3\u5B9A\u662F\u5426\u66F4\u65B0\u9875\u9762\r\n */\r\nasync function updateNews(key: string, glTotItems: string, glbToday: string, glbHistory: string) {\r\n  if (curPageIndex === 1) {\r\n    // \u5F53\u7528\u6237\u5728\u7B2C1\u9875\u65F6\u624D\u89E6\u53D1\u66F4\u65B0\uFF0C\u5426\u5219\u4E0D\u89E6\u53D1\r\n    const item_stat: NewsDataStat[] = await fetchData<NewsDataStat>(\r\n      `http://metro-info.edwardxwliu.cn:5000/stat?key=${key}&per_page=${perPage}`\r\n    );\r\n    const newTotItems = item_stat[0].tot_items;\r\n    const oldTotItems = globalState.getValue(glTotItems);\r\n    if (newTotItems !== oldTotItems) {\r\n      // oldTotItems = newTotItems;\r\n      globalState.setValue(glTotItems, newTotItems);\r\n      loadItems(key, oldPageIndex, glbToday, glbHistory); // \u52A0\u8F7Ditem\u6570\u7EC4\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * \u521B\u5EFA\u6D88\u606Fitem\r\n * @param param0 \u4E00\u4E2A{@link newsData}\u5BF9\u8C61\r\n * @param itemTemplate webflow\u6A21\u677F\r\n * @returns \u4E00\u4E2A{@link HTMLDivElement}\u5BF9\u8C61\r\n */\r\nconst createNewsItem = (\r\n  key: string,\r\n  { type, title, pic_url, url, p_date }: NewsData,\r\n  itemTemplate: HTMLDivElement\r\n) => {\r\n  const item = cloneNode(itemTemplate);\r\n  // console.log(itemTemplate, pic_url);\r\n  const typeElement = item.querySelector<HTMLDivElement>(`[data-element=\"${key}-type\"]`);\r\n  const titleElement = item.querySelector<HTMLLinkElement>(`[data-element=\"${key}-title\"]`);\r\n  // const previewElement = item.querySelector<HTMLDivElement>('[data-element=\"news-preview');\r\n  // const orgElement = item.querySelector<HTMLDivElement>('[data-element=\"news-org\"]');\r\n  const dateElement = item.querySelector<HTMLDivElement>(`[data-element=\"${key}-date\"]`);\r\n  // const imgElement = item.querySelector<HTMLDivElement>(`[data-element=\"${key}-img-preview\"]`);\r\n  const imgElement = item.querySelector<HTMLImageElement>(`[data-element=\"${key}-img-preview\"]`);\r\n  // \u8D4B\u503C\r\n  if (typeElement) {\r\n    typeElement.textContent = type;\r\n  }\r\n  if (titleElement) {\r\n    titleElement.textContent = title;\r\n    titleElement.href = url;\r\n  }\r\n\r\n  if (dateElement) {\r\n    dateElement.textContent = p_date;\r\n  }\r\n\r\n  if (imgElement) {\r\n    // imgElement.style.backgroundImage = `url(${pic_url})`;\r\n    imgElement.src = pic_url;\r\n  }\r\n  item.removeAttribute('data-cloak'); // \u79FB\u9664\u906E\u6321style\r\n  return item;\r\n};\r\n\r\n/**\r\n * \u7F57\u5217\u5E76\u5448\u73B0items\r\n * @param page \u5F53\u524D\u9875\r\n * @returns \u5F02\u5E38\u8FD4\u56DE\r\n */\r\nconst loadItems = async (key: string, page: number, glbToday: string, glbHistory: string) => {\r\n  curPageIndex = page;\r\n  if (page < 1) return;\r\n  // \u83B7\u53D6item json\u6570\u636E\r\n  // const newsData: NewsData[] = await fetchData<NewsData>(\r\n  //   `http://metro-info.edwardxwliu.cn:5000/search?page=${page}&per_page=${perPage}`\r\n  // );\r\n\r\n  const todayNews: NewsData[] = await fetchData<NewsData>(\r\n    `http://metro-info.edwardxwliu.cn:5000/search?key=${key}&page=${page}&per_page=${perPage}&date=${currentDate}&today=1`\r\n  );\r\n  const historyNews: NewsData[] = await fetchData<NewsData>(\r\n    `http://metro-info.edwardxwliu.cn:5000/search?key=${key}&page=${page}&per_page=${perPage}&date=${currentDate}`\r\n  );\r\n\r\n  // \u6709\u5F02\u5E38\u6216\u6CA1\u6709\u6570\u636E\u8FD4\u56DE\u5230\u6839\u76EE\u5F55\r\n  if (!historyNews) {\r\n    window.location.replace('/');\r\n    return;\r\n  }\r\n\r\n  // const todayNews = newsData.filter((data) => data.p_date === currentDate);\r\n  // const historyNews = newsData.filter((data) => data.p_date !== currentDate);\r\n\r\n  const itemTemplateToday = document.querySelector<HTMLDivElement>(\r\n    `[data-element=\"${key}-item-today\"]`\r\n  ); // \u83B7\u53D6webflow\u6A21\u677F\r\n  const itemTemplateHistory = document.querySelector<HTMLDivElement>(\r\n    `[data-element=\"${key}-item-history\"]`\r\n  );\r\n\r\n  const itemMoreWrapperToday = document.querySelector<HTMLDivElement>(\r\n    `[data-element=\"${key}-more-today\"]`\r\n  );\r\n  const itemMoreWrapperHistory = document.querySelector<HTMLDivElement>(\r\n    `[data-element=\"${key}-more-history\"]`\r\n  );\r\n\r\n  if (\r\n    !itemTemplateToday ||\r\n    !itemTemplateHistory ||\r\n    !itemMoreWrapperToday ||\r\n    !itemMoreWrapperHistory\r\n  ) {\r\n    return;\r\n  }\r\n\r\n  itemMoreWrapperToday.hidden = todayNews.length < 10 ? true : false;\r\n  // itemMoreWrapperHistory.hidden = historyNews.length < perPage ? true : false;\r\n\r\n  if (todayNews.length > 0) {\r\n    const itemListToday = itemTemplateToday.parentElement!;\r\n    const newsItemsToday = todayNews.map((data) => createNewsItem(key, data, itemTemplateToday));\r\n\r\n    const oldItemsToday: HTMLDivElement[] = globalState.getValue<HTMLDivElement[]>(glbToday);\r\n\r\n    if (oldItemsToday) {\r\n      oldItemsToday.map((child) => itemListToday.removeChild(child));\r\n    }\r\n    itemListToday.append(...newsItemsToday);\r\n    // oldItemsToday = newsItemsToday;\r\n    globalState.setValue(glbToday, newsItemsToday);\r\n  }\r\n\r\n  if (historyNews.length > 0) {\r\n    const itemListHistory = itemTemplateHistory.parentElement!; // \u83B7\u53D6item\u6A21\u677F\u7236\u5143\u7D20item list component\r\n    // itemTemplate.remove(); // \u5220\u9664\u6A21\u677F\r\n\r\n    const newsItemsHistory = historyNews.map((data) =>\r\n      createNewsItem(key, data, itemTemplateHistory)\r\n    ); // \u4F7F\u7528\u6A21\u677F\u521D\u59CB\u5316item\u6570\u636E\r\n\r\n    const oldItemsHistory: HTMLDivElement[] = globalState.getValue<HTMLDivElement[]>(glbHistory);\r\n    // \u4ECEitemList\u4E2D\u6E05\u9664\u5386\u53F2\u6570\u636E\r\n    if (oldItemsHistory) {\r\n      oldItemsHistory.map((child) => itemListHistory.removeChild(child));\r\n    }\r\n\r\n    itemListHistory.append(...newsItemsHistory); // \u7ED9itemList\u8FFD\u52A0\u65B0\u6570\u636E\r\n    // oldItemsHistory = newsItemsHistory; // \u66F4\u65B0\u4FDD\u5B58\u5386\u53F2\u6570\u636E\r\n    globalState.setValue(glbHistory, newsItemsHistory);\r\n  }\r\n\r\n  oldPageIndex = page; // \u66F4\u65B0\u5386\u53F2\u5BFC\u822Aindex\r\n};\r\n"],
  "mappings": ";;;AAAA,MAAI,YAAY,GAAG,uBAAY,UAAU,EAAE,iBAAiB,UAAU,MAAM,SAAS,OAAO,CAAC;;;ACItF,MAAM,YAAY,CAAC,MAAM,OAAO,SAAS,KAAK,UAAU,IAAI;;;ACInE,iBAAsB,UAAa,KAA2B;AAC5D,QAAI;AACF,YAAM,WAAW,MAAM,MAAM,GAAG;AAChC,UAAI,CAAC,SAAS,IAAI;AAChB,eAAO,CAAC;AAAA,MACV;AAGA,YAAM,OAAO,MAAM,SAAS,KAAK;AACjC,aAAO;AAAA,IACT,SAAS,KAAK;AACZ,aAAO,CAAC;AAAA,IACV;AAAA,EACF;AAMO,WAAS,iBAAyB;AACvC,UAAM,MAAM,KAAK,IAAI;AACrB,UAAM,OAAO,IAAI,KAAK,GAAG;AACzB,UAAM,MAAM,OAAO,KAAK,SAAS,IAAI,CAAC,EAAE,SAAS,GAAG,GAAG;AACvD,UAAM,MAAM,OAAO,KAAK,QAAQ,CAAC,EAAE,SAAS,GAAG,GAAG;AAElD,WAAO,GAAG,KAAK,YAAY,CAAC,IAAI,GAAG,IAAI,GAAG;AAAA,EAC5C;;;AC3BO,WAAS,iBAAiB;AAC/B,UAAM,kBAAkB,SAAS;AAAA,MAC/B;AAAA,IACF;AACA,UAAM,iBAAiB,SAAS;AAAA,MAC9B;AAAA,IACF;AACA,QAAI,CAAC;AAAgB;AACrB,mBAAe,iBAAiB,UAAU,CAAC,UAAU;AACnD,YAAM,eAAe;AACrB,UAAI,CAAC;AAAiB;AACtB,YAAM,WAAW,gBAAgB;AACjC,aAAO,SAAS,OAAO,sBAAsB,mBAAmB,QAAQ,CAAC;AAAA,IAC3E,CAAC;AAAA,EACH;;;ACbA,MAAI,eAAuB;AAC3B,MAAI,eAAuB;AAC3B,MAAM,UAAkB;AACxB,MAAM,cAAsB,eAAe;AAE3C,MAAM,cAAN,MAAkB;AAAA,IAEhB,YAAY,UAAwD;AADpE,WAAQ,YAA0D,CAAC;AAEjE,WAAK,YAAY;AAAA,IACnB;AAAA,IACA,SAAS,KAAa,KAAgC;AACpD,UAAI,OAAO,KAAK,WAAW;AACzB,aAAK,UAAU,GAAG,IAAI;AAAA,MACxB,OAAO;AACL,gBAAQ,IAAI,qBAAqB,GAAG,SAAS;AAAA,MAC/C;AAAA,IACF;AAAA,IACA,SAAY,KAAgB;AAC1B,aAAO,KAAK,UAAU,GAAG;AAAA,IAC3B;AAAA,EACF;AAEA,MAAM,cAAc,IAAI,YAAY;AAAA,IAClC,aAAa;AAAA,IACb,gBAAgB;AAAA,IAChB,cAAc;AAAA,IACd,oBAAoB,CAAC;AAAA;AAAA,IACrB,kBAAkB,CAAC;AAAA,IACnB,uBAAuB,CAAC;AAAA,IACxB,qBAAqB,CAAC;AAAA,IACtB,qBAAqB,CAAC;AAAA,IACtB,mBAAmB,CAAC;AAAA,EACtB,CAAC;AAED,SAAO,YAAY,CAAC;AACpB,SAAO,QAAQ,KAAK,MAAM;AACxB,mBAAe;AAEf,eAAW,OAAO,eAAe,oBAAoB,oBAAoB;AACzE,eAAW,UAAU,kBAAkB,uBAAuB,uBAAuB;AACrF,eAAW,QAAQ,gBAAgB,qBAAqB,qBAAqB;AAE7E,UAAM,cAAc,SAAS,cAAgC,+BAA+B;AAC5F,UAAM,eAAe,SAAS,cAAiC,gCAAgC;AAC/F,YAAQ,IAAI,aAAa,YAAY;AAAA,EACvC,CAAC;AAED,iBAAe,WAAW,KAAa,YAAoB,UAAkB,YAAoB;AAE/F,UAAM,YAA4B,MAAM;AAAA,MACtC,kDAAkD,GAAG,aAAa,OAAO;AAAA,IAC3E;AACA,gBAAY,SAAS,YAAY,UAAU,CAAC,EAAE,SAAS;AACvD,cAAU,KAAK,cAAc,UAAU,UAAU;AACjD,gBAAY,MAAM,WAAW,KAAK,YAAY,UAAU,UAAU,GAAG,GAAI;AAAA,EAC3E;AAKA,iBAAe,WAAW,KAAa,YAAoB,UAAkB,YAAoB;AAC/F,QAAI,iBAAiB,GAAG;AAEtB,YAAM,YAA4B,MAAM;AAAA,QACtC,kDAAkD,GAAG,aAAa,OAAO;AAAA,MAC3E;AACA,YAAM,cAAc,UAAU,CAAC,EAAE;AACjC,YAAM,cAAc,YAAY,SAAS,UAAU;AACnD,UAAI,gBAAgB,aAAa;AAE/B,oBAAY,SAAS,YAAY,WAAW;AAC5C,kBAAU,KAAK,cAAc,UAAU,UAAU;AAAA,MACnD;AAAA,IACF;AAAA,EACF;AAQA,MAAM,iBAAiB,CACrB,KACA,EAAE,MAAM,OAAO,SAAS,KAAK,OAAO,GACpC,iBACG;AACH,UAAM,OAAO,UAAU,YAAY;AAEnC,UAAM,cAAc,KAAK,cAA8B,kBAAkB,GAAG,SAAS;AACrF,UAAM,eAAe,KAAK,cAA+B,kBAAkB,GAAG,UAAU;AAGxF,UAAM,cAAc,KAAK,cAA8B,kBAAkB,GAAG,SAAS;AAErF,UAAM,aAAa,KAAK,cAAgC,kBAAkB,GAAG,gBAAgB;AAE7F,QAAI,aAAa;AACf,kBAAY,cAAc;AAAA,IAC5B;AACA,QAAI,cAAc;AAChB,mBAAa,cAAc;AAC3B,mBAAa,OAAO;AAAA,IACtB;AAEA,QAAI,aAAa;AACf,kBAAY,cAAc;AAAA,IAC5B;AAEA,QAAI,YAAY;AAEd,iBAAW,MAAM;AAAA,IACnB;AACA,SAAK,gBAAgB,YAAY;AACjC,WAAO;AAAA,EACT;AAOA,MAAM,YAAY,OAAO,KAAa,MAAc,UAAkB,eAAuB;AAC3F,mBAAe;AACf,QAAI,OAAO;AAAG;AAMd,UAAM,YAAwB,MAAM;AAAA,MAClC,oDAAoD,GAAG,SAAS,IAAI,aAAa,OAAO,SAAS,WAAW;AAAA,IAC9G;AACA,UAAM,cAA0B,MAAM;AAAA,MACpC,oDAAoD,GAAG,SAAS,IAAI,aAAa,OAAO,SAAS,WAAW;AAAA,IAC9G;AAGA,QAAI,CAAC,aAAa;AAChB,aAAO,SAAS,QAAQ,GAAG;AAC3B;AAAA,IACF;AAKA,UAAM,oBAAoB,SAAS;AAAA,MACjC,kBAAkB,GAAG;AAAA,IACvB;AACA,UAAM,sBAAsB,SAAS;AAAA,MACnC,kBAAkB,GAAG;AAAA,IACvB;AAEA,UAAM,uBAAuB,SAAS;AAAA,MACpC,kBAAkB,GAAG;AAAA,IACvB;AACA,UAAM,yBAAyB,SAAS;AAAA,MACtC,kBAAkB,GAAG;AAAA,IACvB;AAEA,QACE,CAAC,qBACD,CAAC,uBACD,CAAC,wBACD,CAAC,wBACD;AACA;AAAA,IACF;AAEA,yBAAqB,SAAS,UAAU,SAAS,KAAK,OAAO;AAG7D,QAAI,UAAU,SAAS,GAAG;AACxB,YAAM,gBAAgB,kBAAkB;AACxC,YAAM,iBAAiB,UAAU,IAAI,CAAC,SAAS,eAAe,KAAK,MAAM,iBAAiB,CAAC;AAE3F,YAAM,gBAAkC,YAAY,SAA2B,QAAQ;AAEvF,UAAI,eAAe;AACjB,sBAAc,IAAI,CAAC,UAAU,cAAc,YAAY,KAAK,CAAC;AAAA,MAC/D;AACA,oBAAc,OAAO,GAAG,cAAc;AAEtC,kBAAY,SAAS,UAAU,cAAc;AAAA,IAC/C;AAEA,QAAI,YAAY,SAAS,GAAG;AAC1B,YAAM,kBAAkB,oBAAoB;AAG5C,YAAM,mBAAmB,YAAY;AAAA,QAAI,CAAC,SACxC,eAAe,KAAK,MAAM,mBAAmB;AAAA,MAC/C;AAEA,YAAM,kBAAoC,YAAY,SAA2B,UAAU;AAE3F,UAAI,iBAAiB;AACnB,wBAAgB,IAAI,CAAC,UAAU,gBAAgB,YAAY,KAAK,CAAC;AAAA,MACnE;AAEA,sBAAgB,OAAO,GAAG,gBAAgB;AAE1C,kBAAY,SAAS,YAAY,gBAAgB;AAAA,IACnD;AAEA,mBAAe;AAAA,EACjB;",
  "names": []
}
